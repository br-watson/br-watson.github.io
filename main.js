function O(e){let o=new Map;return e.links.github&&o.set("github",e.links.github),e.links.linkedin&&o.set("linkedin",e.links.linkedin),e.filePaths.cv&&o.set("cv",e.filePaths.cv),e.filePaths.dissertation&&o.set("dissertation",e.filePaths.dissertation),e.email&&o.set("email",`mailto:${e.email}`),o}function V({profile:e}){let o=new Map,l=(t,m,a,n,i)=>{o.set(t,{name:t,summary:m,usage:a,execute:n,complete:i})};return l("help","Show this help","help",t=>{let{s:m}=t.seg;t.printLine([m("accent","Available commands")],"ok");let a=Array.from(o.values()).sort((i,p)=>i.name.localeCompare(p.name)).map(i=>`${i.name.padEnd(12," ")} ${i.summary.padEnd(32," ")} ${i.usage}`),n=[`${"COMMAND".padEnd(12," ")} ${"SUMMARY".padEnd(32," ")} USAGE`,"",...a,"","Tips: use \u2191/\u2193 for history, Tab for autocomplete (Shift+Tab to move focus)."];t.printPre(n.join(`
`),"ok")}),l("clear","Clear the screen","clear",t=>t.clear()),l("whoami","About me","whoami",t=>{t.printLine(`${String(e.name)} \u2014 ${String(e.role)} (${String(e.location)})`)}),l("date","Print local date/time","date",t=>{t.printLine(new Date().toString(),"muted")}),l("echo","Print args","echo <text>",(t,m)=>{t.printLine(m.join(" "))}),l("ls","List files (only ~ supported)","ls [path]",(t,m)=>{if((m[0]??"~")!=="~"){t.printLine('ls: only "~" is supported in this tiny filesystem',"error");return}t.printPre(t.listHome().join(`
`),"ok")}),l("cat","Print file contents","cat <file>",(t,m)=>{let{t:a,l:n,s:i}=t.seg,p=m[0];if(!p){t.printLine("cat: missing file operand","error");return}let y=t.resolveHomeItem(p);if(!y){t.printLine(`cat: ${p}: No such file`,"error");return}switch(y.type){case"file":{t.printPre(String(y.content),"ok");break}case"link":{t.printLine([a(`${p} -> `),n(y.href),a(" (click me! or run "),i("accent",`open ${p}`),a(")")],"muted");break}case"links":{let s=(g,v)=>" ".repeat(Math.max(0,v-g.length)),u=Object.entries(y.items).flatMap(([g,v])=>[a(`${g}: `.padEnd(10," ")),n(v,g),a(s(g,10)),a(" (or run "),i("accent",`open ${g}`),a(`)
`)]);t.printLine(u,"muted");break}case"projects":{let s=y.projects.flatMap(u=>[i("accent",`${u.name}
`),a(`${u.desc}
`),...u.repoLink?[n(u.repoLink),a(`
`)]:[a("")],...u.deployedLink?[n(u.deployedLink),a(`
`)]:[a("")],u.tags&&u.tags.length>0?a(`Tech stack: ${u.tags.join(", ")}
`):a(""),a(`
`)]);t.printLine(s,"muted");break}default:{t.printLine(`cat: ${p}: Not a file`,"error");break}}},(t,m)=>{if(m.argIndex!==0)return[];let a=t.listHome().filter(i=>t.resolveHomeItem(i)?.type==="file"||t.resolveHomeItem(i)?.type==="link"||t.resolveHomeItem(i)?.type==="links"),n=(m.prefix??"").toLowerCase();return a.filter(i=>String(i).toLowerCase().startsWith(n)).sort()}),l("open","Open link","open <alias>",(t,m)=>{let{t:a,l:n}=t.seg,i=m[0],p=(i??"").toLowerCase();if(!p){t.printLine("open: missing target (press Tab to see valid options)","error");return}let y=O(t.profile);if(y.has(p)){let s=y.get(p);s&&(t.printLine([a("Opening: "),n(s)],"muted"),t.openUrl(s));return}t.printLine(`open: unknown target "${i}"`,"error")},(t,m)=>{if(m.argIndex!==0)return[];let n=[...O(t.profile).keys()],i=(m.prefix??"").toLowerCase();return Array.from(new Set(n)).filter(p=>String(p).toLowerCase().startsWith(i)).sort()}),l("bio","Alias: cat bio.txt","bio",t=>o.get("cat")?.execute(t,["bio.txt"])),l("projects","Alias: cat projects.txt","projects",t=>o.get("cat")?.execute(t,["projects.txt"])),l("socials","Alias: cat socials.txt","socials",t=>o.get("cat")?.execute(t,["socials.txt"])),l("cv","Alias: open cv","cv",t=>o.get("open")?.execute(t,["cv"])),l("skills","List my skills","skills",t=>o.get("cat")?.execute(t,["skills.txt"])),l("roles","List my roles and experience","roles",t=>o.get("cat")?.execute(t,["roles.txt"])),l("theme","Switch theme","theme [dark|light|toggle]",(t,m)=>{let a=(m[0]??"").toLowerCase(),n=t.theme.get();if(!a){t.printLine(`theme: current is "${n}"`,"muted"),t.printLine("Try: theme dark | theme light | theme toggle","muted");return}if(a==="toggle"){t.theme.toggle(),t.printLine(`theme: set to "${t.theme.get()}"`,"muted");return}if(a!=="dark"&&a!=="light"){t.printLine('theme: expected "dark" or "light"',"error");return}t.theme.set(a),t.printLine(`theme: set to "${a}"`,"muted")},(t,m)=>{if(m.argIndex!==0)return[];let a=["dark","light","toggle"],n=(m.prefix??"").toLowerCase();return Array.from(new Set(a)).filter(i=>String(i).toLowerCase().startsWith(n)).sort()}),{commands:o}}function z(e){return{"~":{type:"dir",children:{"README.txt":{type:"file",content:["Welcome.","","Try: help, ls, cat README.txt, bio, projects, socials, open cv, open github"].join(`
`)},"bio.txt":{type:"file",content:e.bio.join(`
`)},"projects.txt":{type:"projects",projects:e.projects},"socials.txt":{type:"links",items:e.links},"skills.txt":{type:"file",content:e.skills.join(", ")},"roles.txt":{type:"file",content:e.roles.map(o=>{let l=o.title??"Untitled Role",t=o.company?` at ${o.company}`:"",m=o.location?` in ${o.location}`:"",a=` (${o.startDate} - ${o.endDate??"Present"})`,n=o.description?`
  ${o.description}`:"";return`- ${l}${t}${m}${a}${n}`}).join(`

`)},"cv.pdf":{type:"link",href:e.filePaths.cv},"dissertation.pdf":{type:"link",href:e.filePaths.dissertation},"todo.md":{type:"file",content:e.todo.map(o=>`- [ ] ${o}`).join(`
`)}}}}}function Y(e){let o=e["~"];if(!o||o.type!=="dir")throw new Error("Invalid filesystem: missing home dir");return o}function G(e){return Object.keys(Y(e).children).sort()}function J(e,o){return Y(e).children[o]}var E=e=>({type:"text",text:e}),x=(e,o)=>({type:"span",className:e,text:o}),Te=(e,o)=>({type:"link",href:e,text:o});function X({renderer:e,profile:o,fs:l,commands:t,openUrl:m,theme:a}){let n={history:[],historyIndex:-1,completion:null,hasRunCommand:!1,hasBooted:!1};function i(){n.hasBooted=!0,p()}function p(){e.clear(),v(),T([E("Type "),x("accent","help"),E(" to see commands.")],"muted"),e.scrollToBottom()}function y(){!n.hasBooted||n.hasRunCommand||p()}function s(r){return r.reduce((d,c)=>Math.max(d,c.length),0)}function u(r,d){return r.length<=d?r:d<=1?"\u2026":`${r.slice(0,d-1)}\u2026`}function g(r,d){let c=u(r,d),f=Math.max(0,d-c.length),h=Math.floor(f/2),b=f-h;return{leftPad:" ".repeat(h),text:c,rightPad:" ".repeat(b)}}function v(){let r=o.nameAsciiArt??[],d=s(r),c=e.getColumns();if(r.length>0&&d<=c){_(r.join(`
`),"accent"),T(o.role,"muted");return}P()}function P(){let r=String(o.name).trim()||"Portfolio",d=String(o.role).trim()||"Software Engineer",c=e.getColumns(),f=j(c-6,10,54),h=Math.min(20,f),b=Math.max(r.length,d.length,h-4),k=j(b+4,h,f),C=`\u256D${"\u2500".repeat(k+2)}\u256E`,L=`\u251C${"\u2500".repeat(k+2)}\u2524`,$=`\u2570${"\u2500".repeat(k+2)}\u256F`,M=(w,I=!0)=>{let S=g(w,k);return[x("banner-border","\u2502 "),x("banner-border",S.leftPad),x("banner-text",S.text),x("banner-border",S.rightPad),x("banner-border",I?` \u2502
`:" \u2502")]},F=[x("banner-border",`${C}
`),...M(r),x("banner-border",`${L}
`),...M(d),x("banner-border",$)];T(F,"banner")}function j(r,d,c){return Math.max(d,Math.min(c,r))}function T(r,d="ok"){let c=Array.isArray(r)?r:[E(String(r))];e.printLine(c,d)}function _(r,d="ok"){e.printPre(String(r),d)}function H(r){T([x("cmd","$"),E(" "),x("cmd",r)],"cmd")}function D(){return G(l)}function ge(r){return J(l,r)}function q(){return{profile:o,fs:l,theme:a,openUrl:m,printLine:T,printPre:_,seg:{t:E,s:x,l:Te},listHome:D,resolveHomeItem:ge,clear:e.clear}}async function he(r){let d=r.trim();if(!d)return;n.hasRunCommand=!0,H(d);let c=K(d),[f,...h]=c.tokens,b=t.get(f);if(!b){T([E("Command not found: "),x("error",f)],"error"),T([E("Try: "),x("accent","help")],"muted");return}try{await b.execute(q(),h)}catch(k){let C=k instanceof Error?k.message:String(k);T([x("error","Error:"),E(" "),E(C)],"error")}}function K(r){let d=[],c="",f=null,h=!1;for(let b=0;b<r.length;b++){let k=r[b];if(h){c+=k,h=!1;continue}if(k==="\\"){h=!0;continue}if(f){if(k===f){f=null;continue}c+=k;continue}if(k==='"'||k==="'"){f=k;continue}if(/\s/.test(k)){c&&(d.push(c),c="");continue}c+=k}return h&&(c+="\\"),c&&d.push(c),{tokens:d,endsWithWhitespace:/\s$/.test(r),unterminatedQuote:f}}function ye(r){n.history.push(r),n.historyIndex=n.history.length}function ke(){return n.history.length===0?null:(n.historyIndex=Math.max(0,n.historyIndex-1),n.history[n.historyIndex]??"")}function be(){return n.history.length===0?null:(n.historyIndex=Math.min(n.history.length,n.historyIndex+1),n.history[n.historyIndex]??"")}function xe(r){let d=K(r);if(n.completion?.phase==="menu"){let w=n.completion,I=w.values.indexOf(r);if(I!==-1){let S=(I+1)%w.values.length;return w.index=S,w.lastValue=w.values[S],w.lastValue}n.completion=null}let{tokens:c,endsWithWhitespace:f}=d;if(c.length===0)return"";let h=Array.from(t.keys()).sort();if(c.length===1&&!f){let w=c[0],I=h.filter(S=>S.startsWith(w));return Q("cmd",r,w,I,S=>S)??r}let b=c[0],k=t.get(b);if(!k?.complete)return r;let C=c.slice(1),L=f?"":C[C.length-1]??"",$=f?C.length:Math.max(0,C.length-1),M={line:r,tokens:c,args:C,endsWithWhitespace:f,argIndex:$,prefix:L},F=k.complete(q(),M)||[];return Q(`arg:${b}`,r,L,F,w=>[...f?c:c.slice(0,-1),ve(w)].join(" "))??r}function ve(r){return/\s/.test(r)?`"${r.replace(/"/g,'\\"')}"`:r}function Le(r){if(r.length===0)return"";let d=r[0];for(let c=1;c<r.length;c++){let f=r[c],h=0;for(;h<d.length&&h<f.length&&d[h]===f[h];)h++;if(d=d.slice(0,h),d==="")break}return d}function we(r){return r.join("\0")}function Q(r,d,c,f,h){if(f.length===0)return n.completion=null,null;if(f.length===1)return n.completion=null,h(f[0]);let b=we(f),k=Le(f);if(k.length>c.length){let L=h(k);return n.completion={phase:"armed",kind:r,baseInput:L,prefix:k,matchesKey:b,values:f.map(h),index:-1,lastValue:null},L}if(!(n.completion&&n.completion.kind===r&&n.completion.baseInput===d&&n.completion.prefix===c&&n.completion.matchesKey===b))return n.completion={phase:"armed",kind:r,baseInput:d,prefix:c,matchesKey:b,values:f.map(h),index:-1,lastValue:null},null;if(n.completion?.phase==="armed"){let L=[];return f.forEach(($,M)=>{M&&L.push(E("   ")),L.push(x("accent",$))}),T(L,"muted"),e.scrollToBottom(),n.completion.phase="listed",null}if(n.completion?.phase==="listed"){let L=n.completion?.values[0];return n.completion.phase="menu",n.completion.index=0,n.completion.lastValue=L,L}return null}return{boot:i,run:he,addHistory:ye,historyUp:ke,historyDown:be,autocomplete:xe,refreshIntroIfPristine:y}}var A={name:"Bradley Watson",nameAsciiArt:["____________  ___ ______   _    _  ___ _____ _____  _____ _   _","| ___ \\ ___ \\/ _ \\|  _  \\ | |  | |/ _ \\_   _/  ___||  _  | \\ | |","| |_/ / |_/ / /_\\ \\ | | | | |  | / /_\\ \\| | \\ `--. | | | |  \\| |","| ___ \\    /|  _  | | | | | |/\\| |  _  || |  `--. \\| | | | . ` |","| |_/ / |\\ \\| | | | |/ /  \\  /\\  / | | || | /\\__/ /\\ \\_/ / |\\  |","\\____/\\_| \\_\\_| |_/___/    \\/  \\/\\_| |_/\\_/ \\____/  \\___/\\_| \\_/"],role:"Software Engineer",location:"Leeds, UK",email:"you@example.com",links:{github:"https://github.com/br-watson",linkedin:"https://www.linkedin.com/in/bradleyrwatson"},filePaths:{cv:"./assets/cv.pdf",dissertation:"./assets/diss.pdf"},bio:["I build backend systems, pipelines, and cloud infrastructure.","Current interests: TODO...","This site is a small fake shell because normal portfolios are kinda boring."],projects:[{name:"Terminal Portfolio",desc:"This project! An interactive terminal-style portfolio built with TypeScript, HTML, and CSS.",repoLink:"https://github.com/br-watson/br-watson.github.io",deployedLink:"https://bwatson.uk",tags:["TypeScript","HTML","CSS"]},{name:"TODO...",desc:"Lorem ipsum dolor sit amet, consectetur adipiscing elit.",repoLink:"",tags:["TODO..."]}],skills:["TypeScript","AWS","TODO..."],roles:[{title:"Software Engineer",company:"Sky UK",location:"Leeds, UK",startDate:"Sep 2024",description:"TODO..."},{title:"Associate Software Engineer",company:"Sky UK",location:"Leeds, UK",startDate:"Sep 2023",endDate:"Sep 2024",description:"TODO..."}],todo:["Finish writing profile (bio, experience, projects, skills etc.)","Add more commands","Improve txt files output formatting","Make actual CV","Add education section","Add way for mobile to access command history and autocomplete","Make banner nicer on mobile","Write README","Make sure accessibility is good","Make sure performance is good","Add my actual email","Write tests"]};function Z(e){return function(l){let t=new Set(["https:","mailto:"]);try{let m=new URL(l,window.location.href);if(!t.has(m.protocol)&&m.origin!==window.location.origin){e.show("Blocked unsafe URL");return}}catch{e.show("Invalid URL");return}window.open(String(l),"_blank","noopener,noreferrer")}}function ee({form:e,input:o,terminal:l,renderer:t}){function m(){o.focus({preventScroll:!0})}function a(){requestAnimationFrame(()=>{o.selectionStart=o.selectionEnd=o.value.length})}return e.addEventListener("submit",async n=>{n.preventDefault();let i=o.value;o.value="",i.trim()&&(l.addHistory(i),await l.run(i)),t.scrollToBottom(),m()}),o.addEventListener("keydown",n=>{if(!(n.altKey||n.ctrlKey||n.metaKey)){if(n.key==="ArrowUp"){n.preventDefault();let i=l.historyUp();if(i===null)return;o.value=i,a()}if(n.key==="ArrowDown"){n.preventDefault();let i=l.historyDown();if(i===null)return;o.value=i,a()}if(n.key==="Tab"){if(n.shiftKey)return;n.preventDefault(),o.value=l.autocomplete(o.value),a()}}}),{focus:m}}var te="terminal-theme";function _e(e){return e==="light"||e==="dark"}function ne(e){return e.toLowerCase()==="light"?"light":"dark"}function oe(e){return e.toLowerCase()==="light"?"dark":"light"}function re({themeToggle:e,toast:o,storage:l=window.localStorage,doc:t=document,matchMedia:m=window.matchMedia?.bind(window)}){function a(){let g=l.getItem(te);return _e(g)?g:null}function n(){return m?.("(prefers-color-scheme: light)")?.matches?"light":"dark"}let i=a()??n(),p=ne(i);function y(g,v={}){let{persist:P=!0,announce:j=!0,force:T=!1}=v,_=ne(g),H=_!==p;if(p=_,(H||T)&&(t.documentElement.dataset.theme=_,e)){let D=oe(_);e.setAttribute("aria-pressed",String(_==="light")),e.setAttribute("aria-label",`Switch to ${D.toLowerCase()} theme`),e.textContent=D}P&&l.setItem(te,_),j&&H&&o.show(`theme: ${_}`)}let s={get:()=>p,set:g=>y(g,{persist:!0,announce:!0}),toggle:()=>y(oe(p),{persist:!0,announce:!0})};e&&e.addEventListener("click",()=>s.toggle());function u(){y(i,{persist:!1,announce:!1,force:!0})}return{controller:s,applyInitialTheme:u}}function ie(e,o=1500){let l;function t(m){e&&(e.textContent=m,e.classList.add("show"),e.setAttribute("aria-hidden","false"),l&&window.clearTimeout(l),l=window.setTimeout(()=>{e.classList.remove("show"),e.setAttribute("aria-hidden","true")},o))}return{show:t}}function se({screen:e}){function o(){let s=document.createElement("span");s.className="line ok",s.style.position="absolute",s.style.visibility="hidden",s.style.whiteSpace="pre",s.textContent="M",e.appendChild(s);let u=s.getBoundingClientRect().width;return e.removeChild(s),u||8}function l(){let s=o();return Math.max(1,Math.floor(e.clientWidth/s))}function t(s){let u=new Set(["https:","mailto:"]);try{let g=new URL(s,window.location.href);return u.has(g.protocol)?!0:g.origin===window.location.origin}catch{return!1}}function m(s){if(s.type==="text")return document.createTextNode(s.text);if(s.type==="span"){let u=document.createElement("span");return u.className=s.className,u.textContent=s.text,u}if(s.type==="link"){if(!t(s.href))return document.createTextNode(s.text??s.href);let u=document.createElement("a");return u.href=s.href,u.target="_blank",u.rel="noopener noreferrer",u.textContent=s.text??s.href,u}return document.createTextNode("")}function a(s){let u=document.createDocumentFragment();for(let g of s)u.appendChild(m(g));return u}function n(s,u="ok"){let g=document.createElement("div");g.className="block";let v=document.createElement("div");v.className=`line ${u}`,v.appendChild(a(s)),g.appendChild(v),e.appendChild(g)}function i(s,u="ok"){let g=document.createElement("div");g.className="block";let v=document.createElement("div");v.className=`line ${u}`;let P=document.createElement("pre");P.className="pre",P.textContent=s,v.appendChild(P),g.appendChild(v),e.appendChild(g)}function p(){for(;e.firstChild;)e.removeChild(e.firstChild)}function y(){e.scrollTop=e.scrollHeight}return{printLine:n,printPre:i,clear:p,scrollToBottom:y,getColumns:l}}function ae({container:e,list:o,profile:l,onRunCommand:t,aliases:m}){if(!(e instanceof HTMLElement)||!(o instanceof HTMLElement))return;let a=O(l),n=m.filter(i=>a.has(i)).map(i=>`open ${i}`);if(o.replaceChildren(),n.length===0){e.hidden=!0;return}for(let i of n){let p=document.createElement("button");p.type="button",p.className="quick-link",p.dataset.command=i,p.setAttribute("aria-label",`Run ${i}`),p.title=i;let y=document.createElement("span");y.className="quick-link-sigil",y.textContent="$";let s=document.createElement("span");s.textContent=i,p.append(y,s),o.appendChild(p)}o.addEventListener("click",async i=>{let p=i.target;if(!(p instanceof Element))return;let y=p.closest("button[data-command]");if(!(y instanceof HTMLButtonElement))return;let s=y.dataset.command?.trim();s&&(i.detail>0&&y.blur(),await t(s))}),e.hidden=!1}var de=document.getElementById("screen"),Ce=document.getElementById("prompt"),W=document.getElementById("input"),Se=document.getElementById("themeToggle"),Ee=document.getElementById("toast"),le=document.querySelector(".title"),ce=document.querySelector(".ps1"),Pe=document.getElementById("quickLinks"),Ie=document.getElementById("quickLinksList"),B=window.matchMedia("(pointer: coarse)").matches,ue="brad@portfolio";le&&(le.textContent=`${ue}: ~`);ce&&(ce.textContent=ue);var pe=ie(Ee),{controller:Me,applyInitialTheme:$e}=re({themeToggle:Se,toast:pe}),Ae=Z(pe);if(!de)throw new Error("Screen element not found.");var U=se({screen:de}),{commands:Re}=V({profile:A}),R=X({renderer:U,profile:A,fs:z(A),commands:Re,theme:Me,openUrl:Ae}),fe=ee({form:Ce,input:W,terminal:R,renderer:U});ae({container:Pe,list:Ie,profile:A,aliases:["cv","github","linkedin"],onRunCommand:async e=>{B&&document.activeElement===W&&W.blur(),R.addHistory(e),await R.run(e),U.scrollToBottom(),B||fe.focus()}});$e();R.boot();B||fe.focus();var N=0;window.addEventListener("resize",()=>{N&&cancelAnimationFrame(N),N=requestAnimationFrame(()=>{R.refreshIntroIfPristine(),N=0})});var me=0;document.addEventListener("touchend",e=>{let o=performance.now();e.touches.length>0||(o-me<=300&&e.preventDefault(),me=o)},{passive:!1});
